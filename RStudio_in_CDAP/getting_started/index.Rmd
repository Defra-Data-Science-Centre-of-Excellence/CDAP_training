---
title: "Working with RStudio in CDAP"
output:
  html_document:
    toc: yes
    toc_float: true
    toc_depth: 5
date: "23/06/2022"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Purpose: This user guide shows how to access RStudio from within the CDAP PROD environment, close RStudio, and access data from within CDAP.  


## Accessing RStudio on CDAP 

Within the workspace, click on Compute on the menu on the left.  


![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image1.jpg)  



In the table that appears, click on RStudio.  


![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image2.jpg)
  
  
  
In the horizontal menu, click on Apps.   


![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image3.jpg)
  


Click on **Setup RStudio**. This will generate a password which you need to log into RStudio, alongside your Defra or ALB email address which is listed as your username. To copy the password, click on **show** which will reveal the password and copy it.  



![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image4.jpg)
  
  
  
Click on **Open RStudio**. Use your email address as the username to sign in to RStudio, and paste the password. This will take you to RStudio.  

## Closing a session  


If you close the RStudio window but keep other tabs in the browser open, and then reopen RStudio through Databricks, your username and password will be saved and it takes you straight back to RStudio. You can sign out by clicking on the symbol next to your username at the top right of the screen.  


To quit the R session you are in, you need to click on **Quit current R session** at the top right hand side of the screen, otherwise everything in your console will reappear once you go back into RStudio.  


## R version and packages  

The version of R that is available on CDAP depends on the runtime of Databricks that is being used at a given time. At the time of writing, the runtime is 7.6 ML, which gives an R version of 4.0.2.  To check the current runtime, go back to Databricks to see the RStudio cluster, which tells you the runtime in the first tab.

The R packages that are pre-installed also depend on the runtime. For a full list of packages, see the [release notes](https://docs.databricks.com/release-notes/runtime/7.6ml.html) of runtime 7.6 ML (scroll down to R libraries).  

When the runtime of Databricks that is used in CDAP is updated, so will the list and versions of R packages.   

You can also install further packages yourself in the usual way,  however, once you end the session, the package will no longer be available and you need to reinstall it at the next session. You can request for additional packages to be added more formally, so you don't have to reinstall them.  

## RStudio workspace on CDAP

All of your scripts and outputs are saved 

## Accessing data in CDAP from RStudio  


To access the data held within CDAP, enter ```setwd("/dbfs")```. This will give you access to the Databricks File Store (DBFS), where the data in CDAP are held. Under the files tab (usually on the bottom right), you should now see the folders that contain the data (you might have to refresh the page for the files to appear):  


![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image5.jpg)
  
  
  
You can find data on CDAP by going to mnt > landingr, and explore the data held within the landing zone.  

Go back to mnt and you can see the labr folder which contains files from individuals. Set up a new folder for yourself in here, by clicking on New folder, and name the folder according to your email address:   


![](C:/Users/m1007135/OneDrive - Defra/CDAP training/CDAP_training/rstudio_in_cdap/getting_started/images/image6.jpg)

You can load data in the usual way, create an output, and save it into the folder you created in labr:

```{r }
## the tidyverse is pre-installed, so you can load it directly without installing it:
library(tidyverse) 

## Now load the data:
prices <- read_csv("/dbfs/mnt/landingr/General Access/AgriPricing/API-csv-10dec20.csv")

## Investigate the data:
head(prices)

## Create an output: 
ggplot(data = prices, aes(x = category, y = index)) +
  geom_boxplot() +
  coord_flip()

## Save the output. make sure to change the below code to your own email address, into the folder you jusr created:
ggsave("/dbfs/mnt/labr/firstname.lastname@defra.gov.uk/figure1.png") 
```

The file should now be saved in the folder in labr, which you just created.

  
## Uploading data

You can upload your own data directly into your R workspace on CDAP. On the right hand side under Files, select Upload, and then find your local file to upload. it will appear under the R folder in Files.  

You can also upload data into the Databricks Filestore (DBFS), and then access it from within RStudio as described above.

